(()=>{"use strict";window.NAILS.ADMIN.registerPlugin("nails/module-custom-forms","FormEdit",new class{constructor(){this.dom={},this.dom.$container=$(".group-custom-forms.edit"),this.dom.$container.length&&(this.dom.fields={$container:$("#custom-form-fields")},this.dom.notification={$container:$("#field-custom-form-notifications")},this.bindEvents(),this.initialStates())}bindEvents(){this.dom.fields.$container.on("click",".js-remove-field",(i=>{setTimeout((()=>{this.refreshNotifyConditionals(!0)}),50)})).on("blur",".form-builder__field__label",(()=>{this.refreshNotifyConditionals()})).find(".js-add-field").on("click",(()=>{this.refreshNotifyConditionals()})),this.dom.notification.$container.on("dynamic-table:add",((i,t)=>{t.find("select.js-notification-condition-enabled").trigger("change"),this.refreshNotifyConditionals()})).on("change","select.js-notification-condition-enabled",(i=>{this.toggleNotifyConditionals("1"===i.currentTarget.value,$(i.currentTarget).closest("td"))}))}initialStates(){this.dom.notification.$container.find("select.js-notification-condition-enabled").trigger("change"),this.refreshNotifyConditionals(),this.dom.notification.$container.find("select.js-notification-condition-field-id").each(((i,t)=>{let e=$(t);if(e[0].hasAttribute("data-dynamic-table-value")){let i=e.data("dynamic-table-value");$('option[value="'+i+'"]',e).prop("selected",!0),e.trigger("change")}}))}toggleNotifyConditionals(i,t){t.find([".js-notification-condition-field-id",".js-notification-condition-operator",".js-notification-condition-value"].join(", ")).prop("disabled",!i).parent().css({opacity:i?1:.5,"pointer-events":i?"auto":"none"})}refreshNotifyConditionals(i){let t=[];this.dom.fields.$container.find(".form-builder__field").each(((i,e)=>{let o=$(e);t.push({id:o.find(".form-builder__field__id").val(),fieldNumber:o.find(".form-builder__field__field-number").val(),label:o.find(".form-builder__field__label").val()})}));let e=[];if(this.dom.notification.$container.find("select.js-notification-condition-field-id").each(((o,n)=>{let a=$(n),l=a.closest("tr"),d=a.val()||a.data("dynamic-table-value");a.find("option").remove(),$.each(t,((i,t)=>{let e=$("<option>").attr("value",t.id||"fieldNumber:"+t.fieldNumber).html(t.label);a.append(e)}));let s=a.find('option[value="'+d+'"]');if(s.length)s.prop("selected",!0);else if(i){l.find(".js-notification-condition-enabled").val(0).trigger("change");let i=l.find(".js-notification-email").val();e.push(i||"The item at position "+(o+1))}a.trigger("change")})),e.length){let i='The following notifications have been set to "Always" as their condition can no longer be satisfied:<br>';for(let t=0;t<e.length;t++)i+="<br>â€“ "+e[t];$("<div>").html(i).dialog({modal:!0,resizable:!1,draggable:!1,title:"Notification conditions changed",width:500,buttons:{OK:function(){$(this).dialog("close")}}}).show()}}})})();